"use strict";var _interopRequireDefault=require("E:/T/git/奥普Team/opu-components-vue/node_modules/@babel/runtime/helpers/interopRequireDefault");require("core-js/modules/es.array.find-index"),require("core-js/modules/es.array.for-each"),require("core-js/modules/es.array.join"),require("core-js/modules/es.array.map"),require("core-js/modules/es.number.constructor"),require("core-js/modules/es.object.keys"),require("core-js/modules/web.dom-collections.for-each"),Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _objectSpread2=_interopRequireDefault(require("E:/T/git/奥普Team/opu-components-vue/node_modules/@babel/runtime/helpers/esm/objectSpread2")),_dataTable=require("../../dataTable"),_vxeTable=require("vxe-table"),_init=require("../../init");function renderInput(e,t){var r=t.onInputFocus,o=t.onInputKeyUp,a=t.text,n=t.onInputChange,s=t.disabled,l=t.inputProps,i=_init.utils.debounce(n,200);return e("a-input",{props:(0,_objectSpread2.default)((0,_objectSpread2.default)({placeholder:"请选择"},l),{},{value:a,disabled:s}),on:{focus:r,keyup:o,change:i}})}var pulldownPropKeys=Object.keys(_vxeTable.Pulldown.props),_default={name:"PulldownTable",components:{DataTable:_dataTable.DataTable},props:{table:Object,valueField:{type:String,default:"id"},textField:{type:String,default:"name"},searchBefore:Function,searchField:{type:String,default:"keyword"},value:{type:[Object,Array,String,Number]},disabled:Boolean,inputProps:{type:[Object]}},data:function(){return{tableData:[],selectValue:""}},computed:{text:function(){var t=this,e=this.selectValue,r="";return e&&_init.utils.isArray(e)?r=e.map(function(e){return e[t.textField]}).join(","):e&&_init.utils.isObject(e)?r=e[this.textField]:e&&(r=e),r},pulldownExtendProps:function(){var t=this,r={};return pulldownPropKeys.forEach(function(e){r[e]=t[e]}),r},pulldownProps:function(){var e=this.pulldownExtendProps,t=this.$scopedSlots,r=this.$options.propsData,o=Object.assign({},e);return Object.assign(o,{props:(0,_objectSpread2.default)({transfer:!0,"destroy-on-close":!0},r)}),o.ref="pulldownTable",o.scopedSlots=t,o.class="pulldown",o},tableProps:function(){var e=this.table,t=this.tableData,r=this.$scopedSlots,o=this.onTableRowSelect,a=this.onTableCheckboxChange,n={props:(0,_objectSpread2.default)((0,_objectSpread2.default)({},e.props),{},{data:t,columns:e.props.columns}),on:{"current-change":o,"checkbox-change":a,"checkbox-all":a},slot:"dropdown"};return e.props.proxyConfig&&e.props.proxyConfig.ajax&&(n.props.proxyConfig={ajax:(0,_objectSpread2.default)({},e.props.proxyConfig.ajax)}),n.scopedSlots=r,n.ref="table",n}},watch:{value:function(e){this.selectValue=e}},created:function(){this.selectValue=this.value},methods:{onTableRowSelect:function(e){var t=e.row;this.selectValue=t[this.valueField],this.$emit("change",this.selectValue,t),this.$refs.pulldownTable.hidePanel()},onTableCheckboxChange:function(e){var t=e.records;this.selectValue=t,this.$emit("change",this.selectValue)},onInputFocus:function(){this.$refs.pulldownTable.showPanel(),this.$emit("showPanel")},onInputChange:function(e){var t=e.target.value,r=this.table,o=this.searchBefore,a=this.searchField;if(r.props.proxyConfig&&r.props.proxyConfig.ajax&&r.props.proxyConfig.ajax.query){var n={};if(n[a]=t,o){var s=o&&o(n);if(!1===s)return!1;s&&(n=s)}this.$refs.table.onSearchSubmit(n)}this.$emit("inputChange",e)},onInputEnter:function(){var e=this.$refs.table,t=this.$refs.pulldownTable,r=e.getCurrentRecord();r&&t.isPanelVisible()?this.onTableRowSelect({row:r}):this.onInputFocus()},onInputKeyUp:function(e){var t=e.key,r=this.$refs,o=this.onInputEnter,a=this.valueField;if("Enter"==t)return o(),!1;if("ArrowDown"!=t&&"ArrowUp"!=t)return!1;var n=r.table,s=n.getData(),l=n.getCurrentRecord();if(!l&&s&&s.length)n.setCurrentRow(s[0]);else if(s&&s.length){var i=s.findIndex(function(e){return e[a]===l[a]}),u=0;"ArrowUp"===t?(u=i-1)<0&&(u=0):u=i+1,s[u]&&n.setCurrentRow(s[u])}}},render:function(e){var t=this.tableProps;return e("vxe-pulldown",this.pulldownProps,[renderInput(e,this),e("data-table",(0,_objectSpread2.default)((0,_objectSpread2.default)({},t),{on:(0,_objectSpread2.default)({},t.on)}))])}};exports.default=_default;