"use strict";var _interopRequireDefault=require("D:/OpenSource/OPU/opu-components-vue/node_modules/@babel/runtime/helpers/interopRequireDefault");require("core-js/modules/es.array.splice"),Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _objectSpread2=_interopRequireDefault(require("D:/OpenSource/OPU/opu-components-vue/node_modules/@babel/runtime/helpers/esm/objectSpread2")),_vue=_interopRequireDefault(require("vue")),_utils=_interopRequireDefault(require("../../utils")),_sortablejs=_interopRequireDefault(require("sortablejs")),_default={name:"SetColumns",components:{},props:{option:{type:Object,required:!0}},data:function(){return{visible:!1,columns:[]}},computed:{getOpt:function(){var e=this.option;return e.proxyConfig&&e.proxyConfig.get?e.proxyConfig.get:{}},submitOpt:function(){var e=this.option;return e.proxyConfig&&e.proxyConfig.submit?e.proxyConfig.submit:{}},modalOpt:function(){var e=this.option;return e.modal?e.modal:{}}},beforeDestroy:function(){this.sortable&&this.sortable.destroy()},methods:{show:function(){this.visible=!0,this.getOpt.api&&this.fetchColumns()},fetchColumns:function(){var r=this,n=this.getOpt,e=(0,_objectSpread2.default)({},n.param);n.api(e).then(function(e){var t=n.dataField?n.dataField:"data",i=_utils.default.getObjData(t,e);r.columns=i,r.treeDrop()})},treeDrop:function(){var v=this;this.$nextTick(function(){var m=v.$refs.table;v.sortable2=_sortablejs.default.create(m.$el.querySelector(".columns-table .body--wrapper>.vxe-table--body tbody"),{handle:".drag-btn",onEnd:function(e){var t=e.item,i=e.oldIndex,r={children:"children"},n=t,a=n.parentNode,o=n.previousElementSibling,l=v.columns,u=m.getRowNode(n).item,s=_utils.default.findTree(l,function(e){return e===u},r);if(o){var d=m.getRowNode(o).item,c=_utils.default.findTree(l,function(e){return e===d},r);if(_utils.default.findTree(u[r.children],function(e){return d===e},r)){var f=a.children[i];return a.insertBefore(n,f),v.$XModal.message({message:"不允许自己给自己拖动！",status:"error"})}if(m.isTreeExpandByRow(d)){var p=s.items.splice(s.index,1)[0];d[r.children].splice(0,0,p)}else{if((c.parent&&c.parent._XID?c.parent._XID:"")===(s.parent&&s.parent._XID?s.parent._XID:"")){var b=s.items.splice(s.index,1)[0];c.items.splice(c.index+(s.index<c.index?0:1),0,b)}}}else{var h=s.items.splice(s.index,1)[0];l.unshift(h)}m.syncData()}})})},renderShowEdit:function(t){return(0,(new _vue.default).$createElement)("a-checkbox",{props:{checked:t.row.show},on:{input:function(e){t.row.show=e}}})},getData:function(){return this.$refs.table.getTableData()},onCancel:function(){this.visible=!1},onSubmit:function(){var t=this,i=this.submitOpt,e=this.getOpt,r=this.getData();if(i.api){var n=(0,_objectSpread2.default)((0,_objectSpread2.default)({},e.param),{},{data:r.tableData}),a=i.before&&i.before(n);if(!1===a)return!1;a&&(n=a),i.api(n).then(function(e){t.visible=!1,i.after&&i.after(e),t.$emit("submit",e)})}}},render:function(e){var t=this.columns,i=this.renderShowEdit,r=this.modalOpt,n=this.visible,a=this.onSubmit,o=this.onCancel,l=e("span",{class:"drag-btn"},[e("i",{class:"vxe-icon--menu"})]),u=(0,_objectSpread2.default)({},r);return e("a-modal",{props:(0,_objectSpread2.default)((0,_objectSpread2.default)({title:u.title?u.title:"设置表头",width:1e3},u),{},{visible:n}),on:{cancel:o,ok:a},class:"advanced-search-modal"},[e("vxe-grid",{class:"columns-table",ref:"table",props:{border:!0,rowKey:!0,columns:[{width:60,align:"center",slots:{default:"btn_default",header:function(){return"排序"}}},{field:"title",title:"默认标题",align:"center",treeNode:!0},{field:"name",title:"显示标题",align:"center",editRender:{name:"AInput"}},{field:"width",title:"列宽",align:"center",editRender:{name:"AInputNumber"}},{field:"align",title:"对齐方式",align:"center",editRender:{name:"ASelect",options:[{label:"居左",value:"left"},{label:"居中",value:"center"},{label:"居右",value:"right"}]}},{field:"show",title:"显示",align:"center",slots:{default:"show_default"}},{field:"freeze",title:"固定",align:"center",editRender:{name:"ASelect",options:[{label:"靠左",value:"left"},{label:"居中",value:"center"},{label:"靠右",value:"right"}]}}],data:t,treeConfig:{children:"children"},editConfig:{trigger:"click",mode:"row"},checkboxConfig:{checkStrictly:!0}},scopedSlots:{btn_default:function(){return l},show_default:i}},[])])}};exports.default=_default;