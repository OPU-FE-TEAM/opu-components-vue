"use strict";var _interopRequireDefault=require("D:/OpenSource/OPU/opu-components-vue/node_modules/@babel/runtime/helpers/interopRequireDefault");require("core-js/modules/es.array.map"),require("core-js/modules/es.array.splice"),require("core-js/modules/es.string.fixed"),Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _objectSpread2=_interopRequireDefault(require("D:/OpenSource/OPU/opu-components-vue/node_modules/@babel/runtime/helpers/esm/objectSpread2")),_vue=_interopRequireDefault(require("vue")),_utils=_interopRequireDefault(require("../../utils")),_sortablejs=_interopRequireDefault(require("sortablejs")),_conf=_interopRequireDefault(require("../conf")),_default2={name:"SetColumns",components:{},props:{option:{type:Object,default:function(){}},columns:Array},data:function(){return{visible:!1,tableData:[]}},computed:{query:function(){var e=this.option;return e.proxyConfig&&e.proxyConfig.ajax&&e.proxyConfig.ajax.query?e.proxyConfig.ajax.query:null},propsConfig:function(){var e=this.option;return e.proxyConfig&&e.proxyConfig.props?(0,_objectSpread2.default)((0,_objectSpread2.default)({},_conf.default.setColumns.proxyConfig.props),e.proxyConfig.props):_conf.default.setColumns.proxyConfig.props},submit:function(){var e=this.option;return e.proxyConfig&&e.proxyConfig.ajax&&e.proxyConfig.ajax.submit?e.proxyConfig.ajax.submit:null},modalOpt:function(){var e=this.option;return e.modal&&e.modal.props?(0,_objectSpread2.default)((0,_objectSpread2.default)({},_conf.default.setColumns.modal.props),e.modal.props):_conf.default.setColumns.modal.props}},beforeDestroy:function(){this.sortable&&this.sortable.destroy()},methods:{show:function(){this.visible=!0;var e=this.query,t=this.columns,i=this.handelColumns;e?this.fetchColumns():(this.tableData=i(_utils.default.clone(t)),this.treeDrop())},handelColumns:function(e){return e?e.map(function(e){return!1!==e.show&&(e.show=!0),e.defaultTitle||(e.defaultTitle=e.title),e.fixed||(e.fixed=""),e}):[]},fetchColumns:function(){var i=this,e=this.query,r=this.propsConfig,n=this.handelColumns;e().then(function(e){var t=_utils.default.getObjData(r.list,e);i.tableData=n(t),i.treeDrop()})},treeDrop:function(){var g=this;this.$nextTick(function(){var m=g.$refs.table;g.sortable2=_sortablejs.default.create(m.$el.querySelector(".columns-table .body--wrapper>.vxe-table--body tbody"),{handle:".drag-btn",onEnd:function(e){var t=e.item,i=e.oldIndex,r={children:"children"},n=t,o=n.parentNode,a=n.previousElementSibling,l=g.tableData,s=m.getRowNode(n).item,u=_utils.default.findTree(l,function(e){return e===s},r);if(a){var d=m.getRowNode(a).item,f=_utils.default.findTree(l,function(e){return e===d},r);if(_utils.default.findTree(s[r.children],function(e){return d===e},r)){var c=o.children[i];return o.insertBefore(n,c),g.$XModal.message({message:"不允许自己给自己拖动！",status:"error"})}if(m.isTreeExpandByRow(d)){var p=u.items.splice(u.index,1)[0];d[r.children].splice(0,0,p)}else{if((f.parent&&f.parent._XID?f.parent._XID:"")===(u.parent&&u.parent._XID?u.parent._XID:"")){var h=u.items.splice(u.index,1)[0];f.items.splice(f.index+(u.index<f.index?0:1),0,h)}}}else{var b=u.items.splice(u.index,1)[0];l.unshift(b)}m.syncData()}})})},renderShowEdit:function(t){return(0,(new _vue.default).$createElement)("a-checkbox",{props:{checked:t.row.show},on:{input:function(e){t.row.show=e}}})},getData:function(){return this.$refs.table.getTableData()},onCancel:function(){this.visible=!1},onSubmit:function(){var e=this,t=this.submit,i=this.getData().tableData.map(function(e){return"left"!==e.fixed&&"right"!==e.fixed&&delete e.fixed,e});t?t(i).then(function(){e.visible=!1,e.$emit("submit")}):(this.visible=!1,this.$emit("submit",i))}},render:function(e){var t=this.tableData,i=this.renderShowEdit,r=this.modalOpt,n=this.visible,o=this.onSubmit,a=this.onCancel,l=e("span",{class:"drag-btn"},[e("i",{class:"vxe-icon--menu"})]),s=(0,_objectSpread2.default)({},r);return e("a-modal",{props:(0,_objectSpread2.default)((0,_objectSpread2.default)({title:s.title?s.title:"设置表头",width:800},s),{},{visible:n}),on:{cancel:a,ok:o},class:"advanced-search-modal"},[e("vxe-grid",{class:"columns-table",ref:"table",props:{border:!0,rowKey:!0,columns:[{width:60,align:"center",slots:{default:"btn_default",header:function(){return"排序"}}},{field:"defaultTitle",title:"默认标题",align:"center",treeNode:!0},{field:"title",title:"显示标题",align:"center",editRender:{name:"AInput"}},{field:"width",title:"列宽",align:"center",editRender:{name:"AInputNumber"}},{field:"align",title:"对齐方式",align:"center",editRender:{name:"ASelect",options:[{label:"居左",value:"left"},{label:"居中",value:"center"},{label:"居右",value:"right"}]}},{field:"show",title:"显示",align:"center",slots:{default:"show_default"}},{field:"fixed",title:"固定",align:"center",editRender:{name:"ASelect",options:[{label:"不固定",value:""},{label:"靠左",value:"left"},{label:"靠右",value:"right"}]}}],data:t,treeConfig:{children:"children"},editConfig:{trigger:"click",mode:"row"},checkboxConfig:{checkStrictly:!0}},scopedSlots:{btn_default:function(){return l},show_default:i}},[])])}};exports.default=_default2;