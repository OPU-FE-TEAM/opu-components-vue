"use strict";var _interopRequireDefault=require("D:/OpenSource/OPU/opu-components-vue/node_modules/@babel/runtime/helpers/interopRequireDefault");require("core-js/modules/es.array.concat"),require("core-js/modules/es.array.filter"),require("core-js/modules/es.array.for-each"),require("core-js/modules/es.array.map"),require("core-js/modules/es.function.name"),require("core-js/modules/es.object.keys"),require("core-js/modules/es.object.to-string"),require("core-js/modules/es.regexp.to-string"),require("core-js/modules/web.dom-collections.for-each"),Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _objectSpread2=_interopRequireDefault(require("D:/OpenSource/OPU/opu-components-vue/node_modules/@babel/runtime/helpers/esm/objectSpread2")),_vue=_interopRequireDefault(require("vue"));require("vxe-table/lib/index.css");var _utils=_interopRequireDefault(require("../../utils")),_vxeTable=require("vxe-table"),_dataForm=require("../../dataForm"),_conf=_interopRequireDefault(require("../conf")),_setColums=_interopRequireDefault(require("./setColums")),tablePropKeys=Object.keys(_vxeTable.Table.props),methods={};function renderHeadSearch(e,o,t){var r=t.onSearchSubmit,a=t.onButtonActionClick,n=e.items.filter(function(e){return!e.folding});return o("data-form",{ref:"headSearch",props:(0,_objectSpread2.default)((0,_objectSpread2.default)({},e),{},{items:n,onButtonActionClick:a}),class:"head-search-form",on:(0,_objectSpread2.default)((0,_objectSpread2.default)({},e.on),{},{submit:r})})}function renderAdvancedSearch(e,o,t){var r=t.onSearchSubmit,a=t.advancedVisible,n=t.onAdvancedcancel,s=t.onAdvancedSubmit,d=e.items.filter(function(e){return!1!==e.folding}),c=e.advancedSearchForm&&e.advancedSearchForm.props?e.advancedSearchForm.props:{},u=o("data-form",{ref:"advancedSearch",props:(0,_objectSpread2.default)((0,_objectSpread2.default)({},c),{},{items:d,layout:e.foldingLayout?e.foldingLayout:"flex"}),class:"advanced-search-form",on:(0,_objectSpread2.default)((0,_objectSpread2.default)({},e.on),{},{submit:r})}),i=e.advancedSearchModal&&e.advancedSearchModal.props?e.advancedSearchModal.props:{};return o("a-modal",(0,_objectSpread2.default)((0,_objectSpread2.default)({},e.advancedSearchModal),{},{props:(0,_objectSpread2.default)((0,_objectSpread2.default)({},i),{},{title:i.title?i.title:"高级搜索",visible:a}),on:{cancel:n,ok:s},class:"advanced-search-modal"}),[u])}function renderColumnsModal(e,o,t){var r=t.reload;if(!(e.proxyConfig&&e.proxyConfig.get&&e.proxyConfig.get.api&&e.proxyConfig.submit&&e.proxyConfig.submit.api))throw new Error("Please Config proxyConfig the get and submit!");return o("SetColums",{ref:"setColumsModal",props:{option:e},on:{submit:r}})}function renderButton(e,o,t){var r=e.name,a=e.icon,n=e.disabled,s=e.code,d=e.on,c="";return a&&(c=o("a-icon",{props:{type:a}})),t?o("a-menu-item",{key:s,props:{disabled:n},on:d},[c,r]):o("a-button",{key:s,props:{type:e.type,disabled:n},on:d},[c,r])}function renderButtons(e,a){return e?e.map(function(e){if("[object Array]"===Object.prototype.toString.call(e)){var o=e.map(function(e){return renderButton(e,a)});return a("a-button-group",{},[o])}if(e.dropdowns&&e.dropdowns.length){var t=e.dropdowns.map(function(e){return renderButton(e,a,!0)}),r=a("a-menu",{slot:"overlay"},[t]);return a("a-dropdown",{props:{disabled:e.disabled},scopedSlots:{overlay:function(){return r}}},[a("a-button",{},[e.name,a("a-icon",{props:{type:"down"}})])])}if("[object Object]"===Object.prototype.toString.call(e))return renderButton(e,a)}):[]}function renderHeadToolbar(e,o){var t=o.headToolbar,r=o.$nextTick,a=o.$refs,n=o.showSetColumns,s=o.setColumns;if(!t)return!1;var d={ref:"headToolbar",props:{},class:"head-toolbar",scopedSlots:{}};if(t.buttons){var c=renderButtons(t.buttons,e);d.scopedSlots.buttons=function(){return c}}var u="",i="";t.searchConfig&&(i=renderHeadSearch(t.searchConfig,e,o),u=renderAdvancedSearch(t.searchConfig,e,o));var l="";if(t.tools){if(d.props=(0,_objectSpread2.default)({},t.tools),t.tools.setColumns){var p=t.tools.setColumns.button&&t.tools.setColumns.button.props?t.tools.setColumns.button.props:{},f=e("a-button",(0,_objectSpread2.default)((0,_objectSpread2.default)({},t.tools.setColumns.button),{},{props:(0,_objectSpread2.default)({circle:!0,icon:"setting"},p),class:"tool-btn-setcolumns",on:{click:n}}));d.scopedSlots.tools=i?function(){return e("div",{style:{display:"flex"}},[i,f])}:function(){return f},s||(l=renderColumnsModal(t.tools.setColumns,e,o))}r(function(){a.dataGrid.connect(a.headToolbar)})}return!d.scopedSlots.tools&&i&&(d.scopedSlots.tools=function(){return i}),e("div",{class:"head-toolbar-box"},[e("vxe-toolbar",d,[]),u,l])}Object.keys(_vxeTable.Table.methods).forEach(function(o){methods[o]=function(){var e;return this.$refs.dataGrid&&(e=this.$refs.dataGrid)[o].apply(e,arguments)}});var _default={name:"DataTable",components:{DataForm:_dataForm.DataForm,SetColums:_setColums.default},props:(0,_objectSpread2.default)((0,_objectSpread2.default)({},_vxeTable.Table.props),{},{columns:Array,pagerConfig:[Boolean,Object],proxyConfig:Object,toolbar:[Boolean,Object],formConfig:[Boolean,Object],zoomConfig:Object,searchConfig:Object,headToolbar:Object,setColumns:Object}),data:function(){return{tableColumns:[],advancedVisible:!1,searchData:{}}},computed:{tableExtendProps:function(){var o=this,t={};return tablePropKeys.forEach(function(e){t[e]=o[e]}),t},tableProps:function(){var a=this,e=this.$listeners,o=this.$scopedSlots,t=this.tableExtendProps,r=this.handleTableQuery,n=this.tableColumns,s=this.renderCheckbox,d=this.$options.propsData,c=Object.assign({},t),u=n.map(function(e){return e.editRender&&e.editRender.name&&"ACheckbox"===e.editRender.name&&(e.slots={default:"a_checkbox"},o.a_checkbox=s),e});Object.assign(c,{props:(0,_objectSpread2.default)((0,_objectSpread2.default)({},d),{},{columns:u})});var i={};if(_utils.default.each(e,function(e,r){i[r]=function(){for(var e=arguments.length,o=new Array(e),t=0;t<e;t++)o[t]=arguments[t];a.$emit.apply(a,[r].concat(o))}}),c.props.proxyConfig&&c.props.proxyConfig.ajax&&c.props.proxyConfig.ajax.query){var l=c.props.proxyConfig.ajax.query;c.props.proxyConfig.ajax.query=function(e){var o=r(e);return!1!==o&&(o&&(e=o),l(e))}}return c.on=i,c.ref="dataGrid",c.scopedSlots=o,c}},created:function(){var e=this.columns;e&&e.length&&(this.tableColumns=e)},mounted:function(){},beforeDestroy:function(){},destroyed:function(){},methods:(0,_objectSpread2.default)((0,_objectSpread2.default)({},methods),{},{reload:function(){this.$refs.dataGrid.commitProxy("reload")},onSearchSubmit:function(e){this.searchData=e,this.$refs.dataGrid.commitProxy("reload")},handleTableQuery:function(e){var o=this.pagerConfig,t=this.searchData,r={};o&&e.page&&(r[o.props&&o.props.currentPage?o.props.currentPage:_conf.default.pagerConfig.props.currentPage]=e.page.currentPage,r[o.props&&o.props.pageSize?o.props.pageSize:_conf.default.pagerConfig.props.pageSize]=e.page.pageSize);return(0,_objectSpread2.default)((0,_objectSpread2.default)({},t),r)},onButtonActionClick:function(e){var o=this,t=this.searchData;"advancedQuery"===e&&(this.advancedVisible=!0,this.$nextTick(function(){o.$refs.advancedSearch.setData(t)}))},onAdvancedSubmit:function(){var o=this,t=this.$refs,r=this.onAdvancedcancel;t.advancedSearch.validateFields().then(function(e){o.$refs.headSearch.setData(e),o.searchData=e,t.dataGrid.commitProxy("reload"),r()})},onAdvancedcancel:function(){this.advancedVisible=!1},showSetColumns:function(){this.$refs.setColumsModal.show()},renderCheckbox:function(o){return(0,(new _vue.default).$createElement)("a-checkbox",{props:{checked:o.row[o.column.property]},on:{input:function(e){o.row[o.column.property]=e}}})}}),render:function(e){var o=this.tableProps,t=this.setColumns,r=[];return t&&r.push(renderColumnsModal(t,e,this)),e("div",{class:"data-table"},[renderHeadToolbar(e,this),e("vxe-grid",o)].concat(r))}};exports.default=_default;